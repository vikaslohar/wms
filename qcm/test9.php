<?php
	session_start();
	if(!isset($_SESSION['sessionadmin']))
	{
	echo '<script language="JavaScript" type="text/JavaScript">';
	echo "window.location='../login.php' ";
	echo '</script>';
	}
	else
	{
	$year1=$_SESSION['ayear1'];
	$year2=$_SESSION['ayear2'];
	$username= $_SESSION['username'];
	$yearid_id=$_SESSION['yearid_id'];
	$role=$_SESSION['role'];
    $loginid=$_SESSION['loginid'];
    $logid=$_SESSION['logid'];
	$lgnid=$_SESSION['logid'];
	$plantcode=$_SESSION['plantcode'];
	$plantcode1=$_SESSION['plantcode1'];
	$plantcode2=$_SESSION['plantcode2'];
	$plantcode3=$_SESSION['plantcode3'];
	$plantcode4=$_SESSION['plantcode4'];
	}
	require_once("../include/config.php");
	require_once("../include/connection.php");
	
	ini_set("memory_limit","100M");
	
$sql_arr_home=mysqli_query($link,"select distinct(orlot) from tbl_lot_ldg where lotldg_qc!='OK' and lotldg_qc!='Fail' and orlot IN ('DA00004/00000/00','DA00146/00000/00','DA01133/00000/00','DA01190/00001/00','DA01262/00000/00','DA01280/00000/00','DA01290/00000/00','DA01576/00000/00','DA02299/00000/00','DA02394/00000/00','DA06134/00000/00','DA06135/00000/00','DA06137/00000/00','DA06164/00000/00','DA06328/00000/00','DD00160/00000/00','DD00161/00000/00','DD00162/00000/00','DD00163/00000/00','DD07808/00748/00','DD07998/00000/00','DD08394/00000/00','DD08834/00000/00','DD08852/00000/00','DD08859/00000/00','DD08878/00000/00','DF00137/00000/00','DF00304/00000/00','DF00365/00000/00','DF00366/00000/00','DF00369/00000/00','DF00392/00000/00','DF00402/00000/00','DF00433/00000/00','DF00469/00000/00','DF00529/00000/00','DF00568/00000/00','DF00601/00000/00','DF00602/00000/00','DF00603/00000/00','DF00604/00000/00','DF00606/00000/00','DF00607/00000/00','DF00608/00000/00','DF00609/00000/00','DF00611/00000/00','DF00613/00000/00','DF00614/00000/00','DF00615/00000/00','DF00682/00000/00','DF00778/00000/00','DF01094/00000/00','DF01247/00000/00','DF01255/00000/00','DF01259/00000/00','DF01269/00000/00','DF01270/00000/00','DF01338/00000/00','DF01339/00000/00','DF01342/00000/00','DF01350/00000/00','DF01352/00000/00','DF01546/00000/00','DF01547/00000/00','DF01548/00000/00','DF01549/00000/00','DF01550/00000/00','DF01554/00000/00','DF01555/00000/00','DF01557/00000/00','DF01558/00000/00','DF01559/00000/00','DF01566/00000/00','DF01571/00000/00','DF01572/00000/00','DF01573/00000/00','DF01577/00000/00','DF01578/00000/00','DF01583/00000/00','DF01586/00000/00','DF01589/00000/00','DF01590/00000/00','DF01591/00000/00','DF01592/00000/00','DF01730/00000/00','DF01734/00000/00','DF01740/00000/00','DF01747/00000/00','DF01748/00000/00','DF01755/00000/00','DF01758/00000/00','DF01759/00000/00','DF01764/00000/00','DF01765/00000/00','DF01766/00000/00','DF01834/00000/00','DF01839/00000/00','DF01841/00000/00','DF01843/00000/00','DF01844/00000/00','DF01848/00000/00','DF01849/00000/00','DF01850/00000/00','DF01863/00000/00','DF01875/00000/00','DF01891/00000/00','DF01897/00000/00','DF01898/00000/00','DF01899/00000/00','DF01900/00000/00','DF01901/00000/00','DF01902/00000/00','DF01903/00000/00','DF01904/00000/00','DF01905/00000/00','DF01910/00000/00','DF01912/00000/00','DF01913/00000/00','DF01917/00000/00','DF01918/00000/00','DF01919/00000/00','DF01934/00000/00','DF01935/00000/00','DF01937/00000/00','DF01938/00000/00','DF01939/00000/00','DF01941/00000/00','DF01943/00000/00','DF01990/00000/00','DF01995/00000/00','DF01996/00000/00','DF01997/00000/00','DF01998/00000/00','DF01999/00000/00','DF02000/00000/00','DF02002/00000/00','DF02003/00000/00','DF02004/00000/00','DF02006/00000/00','DF02009/00000/00','DF02022/00000/00','DF02023/00000/00','DF02024/00000/00','DF02025/00000/00','DF02026/00000/00','DF02027/00000/00','DF02028/00000/00','DF02029/00000/00','DF02030/00000/00','DF02031/00000/00','DF02032/00000/00','DF02033/00000/00','DF02043/00000/00','DF02047/00000/00','DF02049/00000/00','DF02054/00000/00','DF02055/00000/00','DF02056/00000/00','DF02063/00000/00','DF02066/00000/00','DF02067/00000/00','DF02068/00000/00','DF02070/00000/00','DF02071/00000/00','DF02072/00000/00','DF02074/00000/00','DF02075/00000/00','DF02076/00000/00','DF02077/00000/00','DF02080/00000/00','DF02081/00000/00','DF02082/00000/00','DF02083/00000/00','DF02084/00000/00','DF02085/00000/00','DF02086/00000/00','DF02093/00000/00','DF02095/00000/00','DF02096/00000/00','DF02097/00000/00','DF02098/00000/00','DF02100/00000/00','DF02102/00000/00','DF02103/00000/00','DF02104/00000/00','DF02105/00000/00','DF02112/00000/00','DF02113/00000/00','DF02114/00000/00','DF02115/00000/00','DF02116/00000/00','DF02118/00000/00','DF02121/00000/00','DF02122/00000/00','DF02125/00000/00','DF02126/00000/00','DF02128/00000/00','DF02130/00000/00','DF02132/00000/00','DF02133/00000/00','DF02134/00000/00','DF02135/00000/00','DF02136/00000/00','DF02138/00000/00','DF02143/00000/00','DF02148/00000/00','DF02160/00000/00','DF02161/00000/00','DF02163/00000/00','DF02176/00000/00','DF02185/00000/00','DF02188/00000/00','DF02190/00000/00','DF02191/00000/00','DF02197/00000/00','DF02231/00000/00','DF02232/00000/00','DF02244/00000/00','DF02245/00000/00','DF02343/00000/00','DF02344/00000/00','DF02403/00000/00','DF02404/00000/00','DF02417/00000/00','DF02419/00000/00','DF02420/00000/00','DF02422/00000/00','DF02423/00000/00','DF02426/00000/00','DF02434/00000/00','DF02436/00000/00','DF02441/00000/00','DF02446/00000/00','DF02447/00000/00','DF02449/00000/00','DF02450/00000/00','DF02451/00000/00','DF02452/00000/00','DF02453/00000/00','DF02457/00000/00','DF02458/00000/00','DF02459/00000/00','DF02460/00000/00','DF02462/00000/00','DF02463/00000/00','DF02464/00000/00','DF02470/00000/00','DF02471/00000/00','DF02472/00000/00','DF02473/00000/00','DF02474/00000/00','DF02476/00000/00','DF02478/00000/00','DF02479/00000/00','DF02483/00000/00','DF02497/00000/00','DF02503/00000/00','DF02506/00000/00','DF02512/00000/00','DF02524/00000/00','DF02540/00000/00','DF02543/00000/00','DF02545/00000/00','DF02546/00000/00','DF02632/00000/00','DF02633/00000/00','DF02634/00000/00','DF02639/00000/00','DF02640/00000/00','DF02641/00000/00','DF02662/00000/00','DF02663/00000/00','DF02664/00000/00','DF02755/00000/00','DF02756/00000/00','DF02758/00000/00','DF02759/00000/00','DF03052/00000/00','DF03127/00000/00','DF03128/00000/00','DF03130/00000/00','DF03131/00000/00','DF03132/00000/00','DF03135/00000/00','DF03136/00000/00','DF03137/00000/00','DF03139/00000/00','DF03154/00000/00','DF03179/00000/00','DF03188/00000/00','DF03192/00000/00','DF03193/00000/00','DF03194/00000/00','DF03195/00000/00','DF03209/00000/00','DF03211/00000/00','DF03215/00000/00','DF03216/00000/00','DF03218/00000/00','DF03219/00000/00','DF03221/00000/00','DF03223/00000/00','DF03231/00000/00','DF03257/00000/00','DF03258/00000/00','DF03267/00000/00','DF03268/00000/00','DF03415/00000/00','DF03416/00000/00','DF03417/00000/00','DF03453/00000/00','DF03477/00000/00','DF03478/00000/00','DF03480/00000/00','DF03486/00000/00','DF03492/00000/00','DF03493/00000/00','DF03494/00000/00','DF03498/00000/00','DF03503/00000/00','DF03509/00000/00','DF03514/00000/00','DF03515/00000/00','DF03518/00000/00','DF03520/00000/00','DF03522/00000/00','DF03550/00000/00','DF03581/00000/00','DF03582/00000/00','DF03583/00000/00','DF03584/00000/00','DF03585/00000/00','DF03596/00000/00','DF03597/00000/00','DF03598/00000/00','DF03618/00000/00','DF03642/00000/00','DF03645/00000/00','DF03648/00000/00','DF03651/00000/00','DF03662/00000/00','DF03663/00000/00','DF03664/00000/00','DF03667/00000/00','DF03668/00000/00','DF03671/00000/00','DF03672/00000/00','DF03673/00000/00','DF03679/00000/00','DF03698/00000/00','DF03699/00000/00','DF03702/00000/00','DF03706/00000/00','DF03731/00000/00','DF03769/00000/00','DF03771/00000/00','DF03828/00000/00','DF03842/00000/00','DF03843/00000/00','DF03861/00000/00','DF03862/00000/00','DF03869/00000/00','DF03895/00000/00','DF03921/00000/00','DF03945/00000/00','DF04003/00000/00','DF04004/00000/00','DF04005/00000/00','DF04011/00000/00','DF04016/00000/00','DF04023/00000/00','DF04058/00000/00','DF04060/00000/00','DF04076/00000/00','DF04077/00000/00','DF04081/00000/00','DF04103/00000/00','DF04225/00000/00','DF04244/00000/00','DF04245/00000/00','DF04246/00000/00','DF04443/00000/00','DF90034/00000/00','DF90061/00000/00','DF90062/00000/00','DF90072/00000/00','DF90074/00000/00','DF90075/00000/00','DK00042/00000/00','DN01454/00000/00','DN01873/00000/00','DN01942/00000/00','DN03746/00000/00','DN03801/00000/00','DN05286/00000/00','DN06840/00000/00','DN08654/00000/00','DN10020/00000/00','DN10041/00000/00','DN10310/00000/00','DN10415/00000/00','DN10424/00000/00','DN10427/00000/00','DN10487/00000/00','DN10682/00000/00','DN10768/00000/00','DN10830/00000/00','DN10871/00000/00','DN10875/00000/00','DS00152/00000/00','DS00437/00000/00','DS00608/00000/00','DS00748/00000/00','DS00757/00000/00','DS00802/00000/00','DS00842/00000/00','DS00867/00000/00','DS01002/00000/00','DS01067/00000/00','DS01235/00000/00','DS01372/00000/00','DS01430/00000/00','DS01469/00000/00','DS01481/00000/00','DS01517/00000/00','DS01572/00000/00','DS01715/00000/00','DS02392/00000/00','DS02542/00000/00','DS02739/00000/00','DS02869/00000/00','DS02999/00000/00','DS03026/00000/00','DS03215/00000/00','DS03332/00000/00','DS03500/00000/00','DS04448/00000/00','DS04486/00000/00','DS08310/00000/00','DS08332/00000/00','DS08367/00000/00','DS90007/00000/00','DS90059/00001/00','DS90070/00001/00','DS90125/00000/00','DS90136/00000/00','DS90137/00000/00') order by orlot asc") or die(mysqli_error($link));
$tot_arr_home=mysqli_num_rows($sql_arr_home);

//$total_results = mysql_result(mysqli_query($link,"SELECT COUNT(*) as Num FROM tbl_qctest"),0); 
if($tot_arr_home >0) 
{
 $t=0;
	while($row_arr_home25=mysqli_fetch_array($sql_arr_home))
	{
		$sql_arr_home24=mysqli_query($link,"select * from tbl_lot_ldg where orlot='".$row_arr_home25['orlot']."' and lotldg_qc!='OK' and lotldg_qc!='Fail' order by orlot asc") or die(mysqli_error($link));
		$tot_arr_home24=mysqli_num_rows($sql_arr_home24);
		while($row_arr_home24=mysqli_fetch_array($sql_arr_home24))
		{ 
		
			$sql_arr_home2=mysqli_query($link,"select max(tid) from tbl_qctest where oldlot='".$row_arr_home25['orlot']."' order by tid desc") or die(mysqli_error($link));
			$row_arr_home2=mysqli_fetch_array($sql_arr_home2);
			$ttid=$row_arr_home2[0];
	
			$sql_tbl_sub=mysqli_query($link,"select * from tbl_qctest where oldlot='".$row_arr_home25['orlot']."' and tid='".$ttid."' order by lotno asc") or die(mysqli_error($link));
			while($subtbltot=mysqli_fetch_array($sql_tbl_sub))
			{ 
			//echo $subtbltot['qcstatus'];
				if(($row_arr_home24['lotldg_qc']!="OK" && $row_arr_home24['lotldg_qc']!="Fail")&& ($subtbltot['qcstatus']=="OK" || $subtbltot['qcstatus']=="Fail"))
				{$t++;
				
				//echo $row_arr_home25['orlot']."  -  ".$subtbltot['qcstatus']."  =  ".$row_arr_home24['lotldg_qc'];
				$sql="update tbl_lot_ldg set lotldg_qc='".$subtbltot['qcstatus']."', lotldg_qctestdate='".$subtbltot['testdate']."', lotldg_gemp='".$subtbltot['gemp']."' where orlot='".$row_arr_home25['orlot']."' and lotldg_qc!='OK' and lotldg_qc!='Fail'";
				$xc=mysqli_query($link,$sql) or die(mysqli_error($link));
				//echo "<br />";
				}
			}
		}
	}
}
//echo $t;
 echo "<script>alert('Result Updated......')</script>";
 echo "<script>window.location='index1.php'</script>";
 ?>